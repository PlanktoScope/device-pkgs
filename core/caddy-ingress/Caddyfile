{
  auto_https disable_redirects
}

:80 {
  redir /admin/cockpit /admin/cockpit/
  handle /admin/cockpit/* {
    reverse_proxy host.docker.internal:9090
  }

  handle_path /ps/streams/camera/preview.mjpg {
    rewrite * /stream.mjpg
    reverse_proxy host.docker.internal:8000
  }
  handle_path /ps/streams/segmenter/object.mjpg {
    rewrite * /object.mjpg
    reverse_proxy host.docker.internal:8001
  }

  redir /admin/ps/node-red/v2 /admin/ps/node-red/v2/
  handle /admin/ps/node-red/v2/* {
    reverse_proxy host.docker.internal:1880
  }

  redir / /ps/node-red/v2/ui
  redir /ps/node-red/v2 /ps/node-red/v2/
  handle /ps/node-red/v2/* {
    reverse_proxy host.docker.internal:1880
  }
}
